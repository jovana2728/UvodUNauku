x=seq(-2,3,0.1)
v=x*cos(x)
v
x
r=(x+v)/2
round(r,digits=4)
r=round(r,digits=4)
paste('negativno je',sum(r<0))
A=matrix(c(1,2,7), ncol=1)
B=matrix(c(3,4,8),ncol=1)
A%*%B
t(B)%*%(A%*%t(A))
B%*%t(B) + A%*%t(A) - 100*diag(3)
baza=data.frame(state.x77)
sum(baza$Income<4300)
baza[baza$Income==min(baza$income)]
baza[baza$Income==min(baza$Income),]
baza[baza$Income==max(baza$Income),]
baza$nepismkat=cut(baza$Illiteracy, breaks=c(0,1,2,Inf), labels=c('nisko','srednje','visoko'))
View(baza)
barplot(baza$nepismkat, axes=F, main='Nivo pismenosti')
tablica=table(baza$nepismkat)
barplot(tabla, axes=F, main='Nivo pismenosti')
barplot(tablica, axes=F, main='Nivo pismenosti')
barplot(tablica, axes=F, main='Nivo pismenosti', col=c('red','green','blue'))
axis(1, at=seq(0,26,2))
axis(2, at=seq(0,26,2))
barplot(tablica, axes=F, main='Nivo pismenosti', col=c('red','green','blue'))
axis(2, at=seq(0,26,2))
legend("topright", cex=0.5, fill=c('red','green','blue'), legend=c('nisko','srednje','visoko'))
baza3=data.frame(CO2)
baza3=data.frame(CO2)
View(baza)
View(baza3)
mis=baza3[baza3$Type=='Mississippi',]
qu=baza3[baza3$Type=='Quebec',]
boxplot(mis$uptake,qu$uptake)
boxplot(mis$uptake,qu$uptake, horizontal = T)
boxplot(mis$uptake,qu$uptake, horizontal = T, axes=F)
axis(1)
axis(2)
mis=baza3$uptake[baza3$Type=='Mississippi',]
mis=baza3$uptake[baza3$Type=='Mississippi']
qu=baza3$uptake[baza3$Type=='Quebec']
boxplot(mis,qu, horizontal = T, axes=F)
boxplot(mis,qu, horizontal = T,)
boxplot(mis,qu, horizontal = T)
boxplot(mis,qu, horizontal = T, names=c('Mississippi','Quebec'))
boxplot(mis,qu, horizontal = T, names=c('Mississippi','Quebec'), xlab='Kolicina', ylab='Tipovi')
granica=quantile(qu,0.25)-IQR(qu)*1.5
Quebec=baza3[baza3$Type=='Quebec',]
van=qu<granica
Novab=Quebec[van,]
View(NovaB)
Novab
bazak=read.csv(file.choose(), header=T)
attach(baza)
attach(bazak)
cor(MPG.highway,MPG.city)
model=lm(MPG.highway~MPG.city)
plot(MPG.city,MPG.highway)
abline(model, col='red')
sd(bazak$MPG.highway[bazak$Make=='BMW 535i'])
View(bazak)
coef(model)
model[["coefficients"]][2]*which(bazak$Make=='BMW 535i') + model[["coefficients"]][1]
podaci=read.csv(file.choose(), header=T)
attach(podaci)
cor(MPG.highway,MPG.city)
koef=lm(MPG.highway~MPG.city)
plot(MPG.city,MPG.highway)
abline(koef, col='red')
title('Zavisnost cena')
podaci[podaci$Make =='BMW 535i',]
predict(koef,podaci[podaci$Make=='BMW 535i',])
attach(bazak)
cor(MPG.highway,MPG.city)
View(bazak)
model=lm(MPG.highway~MPG.city)
plot(MPG.city,MPG.highway)
abline(model, col='red')
coef(model)
predict[model,bazak[bazak$Make=='BMW 535i']]
predict[model,bazak$MPG.highway[bazak$Make=='BMW 535i']]
predict[model,bazak$MPG.highway[bazak$Make=='BMW 535i'],]
predict[model,bazak$[bazak$Make=='BMW 535i'],]
predict[model,bazak$[bazak$Make=='BMW 535i',]]
predict(model,bazak$[bazak$Make=='BMW 535i',])
predict(model,bazak$MPG.highway[bazak$Make=='BMW 535i'])
predict(model,bazak$[bazak$Make=='BMW 535i',])
predict(model,bazak$[bazak$Make=='BMW 535i'])
predict(model,bazak[bazak$Make=='BMW 535i'])
predict(model,bazak[bazak$Make=='BMW 535i',])
baza=data.frame(ChickWeight)
levels=chickwts
levels=levels(chickwts)
levels
View(baza)
prva=baza$weight[baza$Diet==1]
drugabaza$weight[baza$Diet==2]
druga=baza$weight[baza$Diet==2]
treca=baza$weight[baza$Diet==3]
cetvrta=baza$weight[baza$Diet==4]
boxplot(prva,druga,treca,cetvrta)
boxplot(prva,druga,treca,cetvrta, names=c('prva','druga','treca','cetvrta'))
baza=data.frame(airquality)
baza=data.frame(airquality)
septembar=baza[baza$Month==9,]
mean(septembar$Wind[which(septembar$Day<15)])
pod=septembar[(septembar$Day>=1) & (septembar$Day<=15),]
jacina=mean(pod$Wind)
jacina
mean(septembar$Wind[which(septembar$Day<=15)])
temp=cut(septembar$Temp, breaks=c(0,quantile(septembar$Temp,0.25),quantile(septembar$Temp,0.75),Inf), names=c('prva','druga','treca'))
temp
tablica=table(temp)
barplot(tablica, col=c('red','green','blue'))
temp=cut(septembar$Temp, breaks=c(0,quantile(septembar$Temp,0.25),quantile(septembar$Temp,0.75),Inf), labels=c('prva','druga','treca'))
temp
tablica=table(temp)
barplot(tablica, col=c('red','green','blue'))
legend("topright", cex=0.5, fill=c('red','green','blue') legend=c('prva','druga','treca'))
legend("topright", cex=0.5, fill=c('red','green','blue'), legend=c('prva','druga','treca'))
title("Nivoi temperature")
baza=read.csv(file.choose(), header= T)
attach(baza)
cor(dijastolni_pritisak,sistolni_pritisak)
model=lm(sistolni_pritisak~dijastolni_pritisak)
plot(dijastolni_pritisak,sistolni_pritisak)
abline(model)
predict(model,baza[baza$sistolni_pritisak==80,])
predict(model,baza[,baza$sistolni_pritisak==80])
predict(model,baza[baza$sistolni_pritisak==80,])
predict(model,baza[baza$dijastolni_pritisak==80,])
view(Baza)
view(baza)
View(baza)
x=c(rep(1,2),-1,-2,-3)
x
summary(x)
boxplot(x)
---
title: "Data Visualization"
library(tidyverse)
```
library(tidyverse)
```
library(tidyverse)
head(mpg)
summary(mpg)
ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy))
ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, shape = class))
nlevels(mpg$class)
mpg$class = factor(mpg$class)
nlevels(mpg$class)
mpg$class = factor(mpg$class)
ggplot(data=mpg) + geom_point(mapping = aes(x=displ, y=hwy, shape=class)) + scale_shape_manual(values=1:nlevels(mpg$class))
summary(mpg)
ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_wrap(~ class, nrow = 2)
geom_smooth(mapping = aes(x = displ, y = hwy))
ggplot(data = mpg) +
geom_smooth(mapping = aes(x = displ, y = hwy))
ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut))
library(nycflight)
library(nycflight13)
library(tidyverse)
library(nycflights13)
library(nycflights)
library(flights)
?flights
installed.packages(nycflights13)
install.packages("nycflights13")
library(nycflights13)
library(tidyverse)
flights
summary(flights)
str(flights)
jan1 = filter(flights, month==1, day ==1)
View(jan1)
(dec25 = filter(flights, month==12, day==25))
print(filter(flights, arr_delay <=120 & dep_delay<=120))
tt = head(flights,1000)
tt
flights_sml = select(flights, year:day, ends_with("delay"), distance, air_time)
flights_sml
mutate(flights_sml, gain=dep_delay - arr_delay, speed = distance / air_time*60)
summarise(flights, delay = mean(dep_delay, na.rm = TRUE))
iris
Credit
library(ISLR)
lm.ft = lm(Balance ~ ., data=Credit)
vif(lm.ft)
library(boot)
boot
?boot
library(car)
vif(lm.ft)
Credit
lm.ft = lm(Balance ~ Limit + Rating, data=Credit)
vif(lm.ft)
library(ggplot2)
data(mpg)
# Napravi 6 podskupova sa oznakom panela
p1 <- transform(mpg, panel = "1) point + smooth")
p2 <- transform(mpg, panel = "2) point + smooth (span=.5)")
p3 <- transform(mpg, panel = "3) point+smooth by drv")
p4 <- transform(mpg, panel = "4) point (α=.6) + smooth .7")
p5 <- transform(mpg, panel = "5) by drv + linetype + smooth")
p6 <- transform(mpg, panel = "6) point by drv (size=2)")
all <- rbind(p1,p2,p3,p4,p5,p6)
ggplot(all, aes(displ, hwy)) +
facet_wrap(~ panel, ncol = 2) +
# Panel 1
geom_point(data = subset(all, panel=="1) point + smooth")) +
geom_smooth(data = subset(all, panel=="1) point + smooth"), se = FALSE) +
# Panel 2
geom_point(data = subset(all, panel=="2) point + smooth (span=.5)")) +
geom_smooth(data = subset(all, panel=="2) point + smooth (span=.5)"),
se = FALSE, span = 0.5) +
# Panel 3
geom_point(data = subset(all, panel=="3) point+smooth by drv"), aes(color = drv)) +
geom_smooth(data = subset(all, panel=="3) point+smooth by drv"),
aes(color = drv), se = FALSE) +
# Panel 4
geom_point(data = subset(all, panel=="4) point (α=.6) + smooth .7"),
aes(color = drv), alpha = 0.6) +
geom_smooth(data = subset(all, panel=="4) point (α=.6) + smooth .7"),
aes(color = drv), se = FALSE, span = 0.7) +
# Panel 5
geom_point(data = subset(all, panel=="5) by drv + linetype + smooth"),
aes(color = drv), alpha = 0.4) +
geom_smooth(data = subset(all, panel=="5) by drv + linetype + smooth"),
aes(color = drv, linetype = drv), se = FALSE) +
# Panel 6
geom_point(data = subset(all, panel=="6) point by drv (size=2)"),
aes(color = drv), size = 2, alpha = 0.7) +
theme_minimal()
install.packages('patchwork')
library(ggplot2)
library(patchwork)
data(mpg)
p1 <- ggplot(mpg, aes(displ, hwy)) + geom_point() + geom_smooth(se=FALSE)
p2 <- ggplot(mpg, aes(displ, hwy)) + geom_point() + geom_smooth(se=FALSE, span=.5)
p3 <- ggplot(mpg, aes(displ, hwy, colour=drv)) + geom_point() + geom_smooth(se=FALSE)
p4 <- ggplot(mpg, aes(displ, hwy, colour=drv)) + geom_point(alpha=.6) + geom_smooth(se=FALSE, span=.7)
p5 <- ggplot(mpg, aes(displ, hwy, colour=drv, linetype=drv)) + geom_point(alpha=.4) + geom_smooth(se=FALSE)
p6 <- ggplot(mpg, aes(displ, hwy, colour=drv)) + geom_point(size=2, alpha=.7)
# 3×2 raspored, legende ostaju odvojene po grafu
(p1 | p2) / (p3 | p4) / (p5 | p6)
library(ggplot2)
library(patchwork)
data(mpg)
p1 <- ggplot(mpg, aes(displ, hwy)) + geom_point() + geom_smooth(se=FALSE)
p2 <- ggplot(mpg, aes(displ, hwy)) + geom_point() + geom_smooth(se=FALSE, span=.5)
p3 <- ggplot(mpg, aes(displ, hwy, colour=drv)) + geom_point() + geom_smooth(se=FALSE)
p4 <- ggplot(mpg, aes(displ, hwy, colour=drv)) + geom_point(alpha=.6) + geom_smooth(se=FALSE, span=.7)
p5 <- ggplot(mpg, aes(displ, hwy, colour=drv, linetype=drv)) + geom_point(alpha=.4) + geom_smooth(se=FALSE)
p6 <- ggplot(mpg, aes(displ, hwy, colour=drv)) + geom_point(size=2, alpha=.7)
# 3×2 raspored, legende ostaju odvojene po grafu
(p1 | p2 | p3) / ( p4) / (p5 | p6)
install.packages('MASS')
MASS
library(MASS)
Boston
boston = Boston
library(tidyverse)
str(boston)
summary(boston)
?Boston
unique(chas)
unique(boston$chas)
boston$chas = factor(boston$chas, levels=c(0,1), labels=c('blizu', 'daleko'))
summary(boston)
str(boston)
ggplot(boston, mapping=aes(x=chas, y=age)) + geom_boxplot()
ggplot(boston, mapping=aes(x=chas, y=medv)) + geom_boxplot()
ggplot(boston, mapping=aes(x=age)) + geom_histogram()
summary(boston$age)
boston$ageCategory[boston$age <=10] = 'nova'
boston$ageCategory[boston$age >10 & boston$age<=30] = 'srednja'
boston$ageCategory[boston$age >30] = 'stara'
summary(boston)
boston
str(boston)
boston$ageCategory = factor(boston$ageCategory, levels =c('mlada','srednja','stara'))
str(boston)
ggplot(boston, mapping=aes(x=crim, y=medv)) + geom_point()
ggplot(boston, mapping=aes(x=crim, y=medv)) + geom_point( mapping=aes(color=ageCategory))
boston$ageCategory[boston$age <=10] = 'mlada'
ggplot(boston, mapping=aes(x=crim, y=medv)) + geom_point( mapping=aes(color=ageCategory))
ggplot(boston, mapping=aes(x=age, y=medv)) + geom_point()
ggplot(boston, mapping=aes(x=tax, y=medv)) + geom_point()
ggplot(boston, mapping=aes(x=dis, y=medv)) + geom_point()
ggplot(boston, mapping=aes(x=crim*age, y=medv)) + geom_point( mapping=aes(color=ageCategory))
ggplot(boston, mapping=aes(x=crim, y=medv)) + geom_point( mapping=aes(color=ageCategory))
lm.crime = lm(medv ~., data=boston)
lm.fit = lm(medv ~., data=boston)
summary(lm)
summary(lm.fit)
lm.crime = lm(medv ~crim, data=boston)
summary(lm.crime)
ggplot(boston, mapping=aes(x=black, y=medv)) + geom_point()
lm.blackcrime = lm(medv ~crim+black, data=boston)
summary(lm.blackcrime)
lm.rad = lm(medv ~rad, data=boston)
summary(lm.rad)
lm.chas = lm(medv ~chas, data=boston)
summary(lm.chas)
lm.rad = lm(medv ~rad, data=boston)
summary(lm.rad)
lm.ag = lm(medv ~. -indus - age - ageCategory, data=boston)
summary(lm.ag)
lm.ag = lm(medv ~. -indus - age - ageCategory - nox, - dis - rad - ptratio, data=boston)
summary(lm.ag)
install.packages('leaps')
najbolji = regsubsets(medv~., data=boston, nvmax=14)
library(leaps)
najbolji = regsubsets(medv~., data=boston, nvmax=14)
summary(najbolji)
lm.lstat = lm(medv ~lstat, data=boston)
summary(lm.lstat)
boston\
boston
sda
n = nrow(boston)
train_idx = sample(1:n, round(0.85*n))
train = boston[train_idx]
train = boston[train_idx,]
test = boston[-train_idx,]
najbolji = regsubsets(medv ~.,boston, nvmax = 1)
summary(najbolji)
ggplot(data=boston, mapping=aes(x=crim,y=medv)) + geom_point()
ggplot(data=boston, mapping=aes(x=tax,y=medv)) + geom_point()
ggplot(data=boston, mapping=aes(x=lstat,y=medv)) + geom_point()
#potencijalno se vidi da postoji neka zavisnost koja je nelinearna, posto ima tu krivinu
#uzeo sam one parametre koje sam mislio da su najbitniji, ovo je samo simulacija, moze tu i age da se uzme i udaljenost od autoputeva i slicno, ali ovo je samo primera radi
#ovde mi i grafici ali i regsubsets govore da je lstat najbolji prediktor za prostu linearnu regresiju, iz razloga sto se na njemu najbolje uocavaju trendovi kod cene, odnosno sa porastom lstata smanjuje se srednja cena kuca
lm.lstat = lm(medv~lstat, data=boston)
summary(lstat)
summary(lm.lstat)
kao što se može videti na osnovu samih dakle statistika takoreći, primećujemo da je njegov p value jako nizak, odnosno da je vrlo značajan kao prediktor, standardna greška je negde oko 6.216 što, kada se gleda u hiljadama, u zavisnosti od visine cena, po mom mišljenju jeste primetna, ali i nije baš presudna, mada može biti. što se tiče r^2 on mi govori da prediktor objašnjava nešto malo preko 50% varijanse, što i nije baš sjajno, dok je sam adjusted rsquared ovde i nevažan posebno. Fstatistika je prilično visoka, nama je jasno da je naš izabrani prediktor lstat jednak nuli, ali to nam je takođe jasno iz njegove p vrednosti iz koje uočavamo njegovu značajnost
plot(lm.lstat)
#grafike ne znam baš da objasnim, to ćemo zajedno posle
#za dati prediktor ima razloga raditi polinomijalnu regresiju, iz razloga što se može uočiti da je veza izmedju njega i izlaza nelinearna time što je na grafiku poprilično uočljiv trend zakrivljenja, te kako bismo postigli linearnu vezu potrebno je izvesti polinomijalnu regresiju na sledeći način
lm.polinomiallstat = lm(medv~ lstat + I(lstat^2), data=boston)
summary(lm.polinomiallstat)
plot(lm.polinomiallstat)
#nakon što smo uradili polinomijalnu regresiju, primećujemo da se greška smanjila, da je r2 porastao, odnosno da smo objasnili veći procenat varijanse, a takođe se primeti i da je adjr2 porastao, što nam dodatno govori da je pravljenje polinomijalne regresije urodilo plodom, f statistika se smanjila malo , i dalje je visoka ali nam govori da sada model bolje uklapa podatke
#predikcija nad testnim podacima
predikcije = predict(lm.polinomiallstat, newdata = test)
summary(predikcije)
#za proveravanje toga koji prediktor bi bio najbolji ukoliko bi se uzela dva prediktora, možemo koristiti regsubsets ili možemo ručno tražiti drugi najbolji prediktor koristeći se sinergijom i nekim smerom, npr sinergijom lstata i taksi, crime ratea i slično, ali ću ovde upotrebiti regsubsets
najbolji
summary(najbolji)
najbolji = regsubsets(medv ~.,boston, nvmax = 2)
summary(najbolji)
#na osnovu ovoga on tvrdi da je rm odnosno prosecan broj soba drugi najbolji prediktor, tako da cemo raditi po tome
lm.fit2 = lm(medv~ lstat+ I(lstat^2)+rm, data=boston)
summary(lm.fit2)
#kao što primetimo, čak smo i dodatno poboljšali preciznost, standardna greška je smanjena na 5 hiljada, procenat objašnjene varijanse je .70, a ajdusted r2 je takodje porastao, što nam govori da takodje je imalo smisla dodati i novi prediktor, f statistika se takođe malo smanjila, te nam je jasno da je uklapanje podataka ponovo bolje, tako da ćemo ići sa ovim modelom, odgovor, da ovaj model među odabranima najbolje fituje podatke
library(ISLR)
library(car)
car
library(car)
?car
credit= Credit
#prvo odmah da odradimo podelu podataka na testne i trening podatke
#uzećemo odnos 80 prema 20 posto nije navedeno
n = nrow(credit)
train_idx = sample(1:n,round(0.8*n))
#zaboravio sam tako da cu sada postaviti seed prvo
set.seed(123)
train_idx = sample(1:n,round(0.8*n))
train_idx = sample(1:n,round(0.8*n))
train_idx = sample(1:n,round(0.8*n))
train_idx = sample(1:n,round(0.8*n))
train_idx = sample(1:n,round(0.8*n))
n = nrow(credit)
> train_idx = sample(1:n,round(0.8*n))
n = nrow(credit)
train_idx = sample(1:n,round(0.8*n))
#zaboravio sam tako da cu sada postaviti seed prvo
set.seed(123)
train_idx = sample(1:n,round(0.8*n))
n = nrow(credit)
set.seed(123)
train_idx = sample(1:n,round(0.8*n))
library(glmnet)
X = model.matrix(Balance ~.,data=Credit)[,-1]
View(X)
Y = Credit$Balance
x_train = X[train_idx,]
y_train = Y[train_idx]
x_test = X[-train_idx,]
y_test = Y[-train_idx]
ridge = cv.glmnet(x_train,y_train,alpha=1, nfolds = 10)
lasso = cv.glmnet(x_train,y_train,alpha=1, nfolds = 10)
ridge = cv.glmnet(x_train,y_train,alpha=0, nfolds = 10)
#zaboravio sam gore da navedem, dakle napravili smo model matrix zavisnosti balansa od svih ostalih prediktora i isključili intercept, jer će model sam da kreira novi, pa da se ne bi ponavljao, potom smo y postavili na output, onda smo podelili sve ulaze na trening i test, i sve izlaze na trening i test, potom smo odradili lasso i ridge, čisto eto, ovde nam je samo lasso bitan
lambdamin = lasso$lambda.min
#uzimamo minimalnu lambu i primećujemo da kažnjavamo koeficijente sa tom vrednošću, ostalo je odraditi predikciju samog modela i da vidimo kako se on snalazi
y_predict = predict(lasso,s=lambdamin, newx = x_test)
RMSE = sqrt(mean(sum((y_predict-y_test)^2)))
RMSE
coef(lasso,lambdamin)
sum(coef(lasso,lambdamin))
n(coef(lasso,lambdamin)
n(coef(lasso,lambdamin))
Credit
source("C:/Users/Djole/Desktop/UUNP kolokvijumi/Kolokvijum 2023-2024.R")
gc()
library(tidyverse)
library(dplyr)
library(ggplot2)
library(readr)
df <- read_csv("UCI_Credit_Card.csv")
setwd("C:/Users/Djole/Desktop/UUNOP Seminarski")
df <- read_csv("UCI_Credit_Card.csv")
head(df)
dim(df)
describe(df)
summary(df)
head(df)
View(df)
table(df$EDUCATION)
table(df$SEX)
table(df$MARRIAGE)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(readr)
setwd("C:/Users/Djole/Desktop/UUNOP Seminarski")
df <- read_csv("UCI_Credit_Card.csv")
View(df)
df$EDUCATION[df$EDUCATION %in% c(0, 6)] <- 5
gc()
library(tidyverse)
library(dplyr)
library(ggplot2)
library(readr)
setwd("C:/Users/Djole/Desktop/UUNOP Seminarski")
df <- read_csv("UCI_Credit_Card.csv")
df$EDUCATION[df$EDUCATION %in% c(0, 6)] <- 5
str(df)
table(df$MARRIAGE)
df <- read_csv("UCI_Credit_Card.csv")
df %>%
filter(EDUCATION == 0 & MARRIAGE == 0) %>%
select(ID, EDUCATION, MARRIAGE)
df
table(df$SEX)
df$EDUCATION[df$EDUCATION %in% c(0, 6)] <- 5
table(df$MARRIAGE)
summary(df$AGE)
df$MARRIAGE[df$MARRIAGE == 0] <- 3
summary(df)
sapply(df[, c("PAY_0","PAY_2","PAY_3","PAY_4","PAY_5","PAY_6")],
function(x) sum(x == -2))
df %>%
filter(PAY_0 == -2) %>%
summarise(mean(BILL_AMT1), mean(PAY_AMT1), mean(default.payment.next.month))
sum(apply(df[, c("PAY_0","PAY_2","PAY_3","PAY_4","PAY_5","PAY_6")], 1, function(x) all(x == -2)))
sum(apply(df[, c("PAY_0","PAY_2","PAY_3","PAY_4","PAY_5","PAY_6")], 1, function(x) any(x == -2)))
df %>%
mutate(has_minus2 = apply(select(., PAY_0, PAY_2, PAY_3, PAY_4, PAY_5, PAY_6), 1, function(x) any(x == -2))) %>%
group_by(has_minus2) %>%
summarise(
avg_limit = mean(LIMIT_BAL),
avg_age = mean(AGE),
default_rate = mean(default.payment.next.month)
)
df %>%
mutate(has_minus2 = apply(select(., PAY_0, PAY_2, PAY_3, PAY_4, PAY_5, PAY_6), 1, function(x) any(x == -2))) %>%
group_by(has_minus2, EDUCATION) %>%
summarise(n = n()) %>%
mutate(share = n / sum(n))
df %>%
filter(PAY_0 == -2) %>%
summarise(across(starts_with("BILL_AMT"), mean),
across(starts_with("PAY_AMT"), mean))
df %>%
mutate(has_minus2 = apply(select(., PAY_0, PAY_2, PAY_3, PAY_4, PAY_5, PAY_6), 1, function(x) any(x == -2))) %>%
group_by(has_minus2) %>%
summarise(
avg_limit = mean(LIMIT_BAL),
avg_age = mean(AGE),
default_rate = mean(default.payment.next.month)
)
df %>%
mutate(has_minus2 = apply(select(., PAY_0, PAY_2, PAY_3, PAY_4, PAY_5, PAY_6), 1, function(x) any(x == -2))) %>%
group_by(has_minus2, EDUCATION) %>%
summarise(n = n()) %>%
mutate(share = n / sum(n))
df %>%
mutate(has_minus2 = apply(select(., PAY_0, PAY_2, PAY_3, PAY_4, PAY_5, PAY_6), 1, function(x) any(x == -2))) %>%
group_by(has_minus2, SEX) %>%
summarise(n = n()) %>%
mutate(share = n / sum(n))
df %>%
mutate(has_minus2 = apply(select(., PAY_0, PAY_2, PAY_3, PAY_4, PAY_5, PAY_6), 1, function(x) any(x == -2))) %>%
group_by(has_minus2, MARRIAGE) %>%
summarise(n = n()) %>%
mutate(share = n / sum(n))
sapply(df[, c("PAY_0","PAY_2","PAY_3","PAY_4","PAY_5","PAY_6")],
function(x) sum(x == -2))
df$had_minus2 <- apply(df[, c("PAY_0","PAY_2","PAY_3","PAY_4","PAY_5","PAY_6")],
1, function(x) any(x == -2))
pay_cols <- c("PAY_0","PAY_2","PAY_3","PAY_4","PAY_5","PAY_6")
df[, pay_cols] <- lapply(df[, pay_cols], function(x) ifelse(x == -2, -1, x))
sapply(df[, pay_cols], function(x) any(x == -2))
